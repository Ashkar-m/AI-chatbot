

 {% extends 'base.html' %}

{% block content %}
<div class="container mt-5">
    <div class="row justify-content-center">
        <div class="col-md-6">
            <div class="card shadow">
                <div class="card-body">
                    <h2 class="card-title text-center mb-4">Payment</h2>
                    <form id="payment-form" class="text-center">
                        <button id="submit" class="btn btn-success btn-lg w-100">Pay $50</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://js.stripe.com/v3/"></script>
<script>
    const stripe = Stripe("pk_test_51QV6ZtIqpMVb5nWenzdEG2jpLAF9KuRngPXgiX09m07cVDoGxLVmKnocHZuLSaW7gfOwiw1N3VJ77CtNzZUaqIko00n2xNTnsh");

    document.getElementById("payment-form").addEventListener("submit", async (e) => {
        e.preventDefault();

        // Send a POST request to create the Stripe Checkout session
        const response = await fetch("/payment", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({})  // Send any data needed for the payment here
        });

        // Ensure response is valid
        if (!response.ok) {
            alert("Error creating payment session. Please try again.");
            return;
        }

        const session = await response.json();

        if (session.id) {
            const checkoutWindow = window.open("", "_blank", "width=375, height=667, location=no, toolbar=no, menubar=no, resizable=no");
            // Redirect the user to Stripe Checkout
            stripe.redirectToCheckout({ sessionId: session.id }).then(function (result) {
                if (result.error) {
                    alert(result.error.message);  // Show an error message if there's an issue
                }
            });
        } else {
            alert("Error creating checkout session.");
        }
    });
</script>
{% endblock %}
